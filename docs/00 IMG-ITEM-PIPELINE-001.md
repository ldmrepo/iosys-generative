팀장님, **GPT-5.2 Thinking (2026-01-27, Asia/Seoul)** 기준으로
요청하신 **기술문서 작성 규칙(목적 → 타스크 → 타스크별 기술사항)**을 **엄격히 준수**하여
**이미지 참조형 문항 생성 최종 파이프라인**을 기술 문서 형식으로 작성합니다.

---

# 📘 이미지 참조 기반 문항 생성 파이프라인 기술 문서

**문서 ID**: IMG-ITEM-PIPELINE-001
**버전**: v1.0.0
**문서 성격**: 아키텍처 / 생성 파이프라인 기술 명세
**대상 독자**: AI/ML 엔지니어, 문항은행(Item Bank) 설계자, 평가 시스템 아키텍트

---

## 1️⃣ 해결하려는 목적

본 문서의 목적은 다음과 같다.

> **이미지와 문항 텍스트 간의 논리적 무결성을 시스템적으로 보장하면서,
> 수학·물리·지도·UI·사진·다이어그램 등 서로 성격이 다른 이미지를 활용한
> 문항을 자동 생성할 수 있는 표준 파이프라인을 정의한다.**

이를 통해 다음 문제를 해결하고자 한다.

* 이미지 기반 문항 생성 시 발생하는 **환각(Hallucination)**
* 이미지에 없는 정보에 대한 **추론형 질문 생성**
* 문항·정답·해설 간 **근거 불일치**
* 이미지 유형별로 다른 해석 규칙이 혼재되는 문제
* 문항 품질을 **정의·검증·감사**할 수 없는 구조적 한계

---

## 2️⃣ 해결해야 할 타스크 목록

본 목적을 달성하기 위해 다음 타스크를 단계적으로 해결한다.

1. **이미지 유형 선분류(Image Type Routing)**
2. **도메인별 사실(Fact) 추출**
3. **Fact Graph 단일 근거 모델 구축**
4. **문항 Blueprint 선택**
5. **Fact 제약 기반 문항 생성**
6. **논리 무결성 자동 검증(Integrity Gate)**
7. **오류 복구 및 인간 검토 루프 설계**

---

## 3️⃣ 타스크별 기술 사항

---

### Task 1. 이미지 유형 선분류 (Image Type Routing)

#### 목적

* 이미지 해석 방식과 허용 질문 범위를 **초기 단계에서 고정**하기 위함

#### 기술 사항

* 입력 이미지를 다음 중 하나로 분류

  * `math`, `physics`, `map`, `ui`, `photo`, `diagram`
* 분류 결과는 이후 모든 단계의 **제약 조건의 기준점**이 됨

#### 기술적 결정

* 이미지 유형에 따라 다음 항목이 고정됨

  * 사용 가능한 Fact Extractor
  * 허용 Claim 타입 / 금지 Claim 타입
  * 적용할 무결성 검증 규칙
  * 선택 가능한 문항 Blueprint

> ⚠️ 본 단계 이후 허용 Claim 공간은 **확장 불가**

---

### Task 2. 도메인별 사실(Fact) 추출

#### 목적

* 이미지를 자연어 설명이 아닌 **검증 가능한 기계적 사실**로 변환

#### 기술 사항

* 이미지 유형별 Fact Extractor 사용

  * 수학: 좌표, 절편, 기울기
  * 물리: 거리, 수직/평행 관계
  * 지도: 거리, 인접성, 위치
  * UI: 버튼 상태, 텍스트, 경로
  * 사진: 객체 존재, 개수, 가시적 속성

#### 핵심 원칙

* “보인다”, “추정된다”, “의도가 있다” → **Fact 아님**
* 모든 Fact는 `confidence` 값을 포함

---

### Task 3. Fact Graph 구축 (Single Source of Truth)

#### 목적

* 문항 생성과 검증의 **유일한 근거 데이터 모델** 확보

#### 기술 사항

* Fact Graph는 다음을 포함

  * Entities (객체)
  * Relations (관계)
  * Numerics (수치)
  * Confidence (신뢰도)
  * Provenance (추출 이력)

#### 설계 원칙

* 이미지, 문항, 정답, 해설은 **모두 동일 Fact Graph를 참조**
* Fact Graph 생성 이후 **이미지는 직접 참조하지 않음**

---

### Task 4. 문항 Blueprint 선택

#### 목적

* “이 이미지로 무엇을 물을 수 있는가”를 명시적으로 제한

#### 기술 사항

* 이미지 유형별 허용 Blueprint 사전 정의

  * 예)

    * 수학: 기울기 계산, 절편 판단
    * 지도: 거리 비교, 인접 판단
    * 사진: 개수 확인, 존재 여부

#### 정책

* Blueprint 미선택 상태에서 문항 생성 **금지**

---

### Task 5. Fact 제약 기반 문항 생성

#### 목적

* 문항 텍스트를 **사실 기반으로만 조립**하여 환각 제거

#### 기술 사항

* 모든 문장은 Claim 단위로 생성
* 모든 Claim은 최소 1개 이상의 Fact ID와 연결
* 정답 및 오답은 Fact에서 **1-hop 파생만 허용**

#### 금지 사항

* 이미지 직접 참조 생성
* Fact에 없는 수치·관계 사용

---

### Task 6. 논리 무결성 자동 검증 (Integrity Gate)

#### 목적

* 생성된 문항의 신뢰성을 **시스템적으로 판정**

#### 검증 항목

1. 참조 무결성 (언급 대상 존재 여부)
2. 수치 재현성 (Fact 기반 재계산 가능 여부)
3. 관계 무결성 (논리 모순 여부)
4. 정보 충분성 (문제 해결 정보 충족 여부)
5. 도메인 위반 여부 (사진에서 추론 질문 등)

#### 결과

* PASS / FAIL
* 무결성 점수 및 실패 사유 기록

---

### Task 7. 오류 복구 및 인간 검토 루프

#### 목적

* 자동 생성의 한계를 보완하고 품질을 최종 보장

#### 기술 사항

* 실패 유형별 자동 처리

  * 표현 오류 → 재서술
  * 수치 오류 → 정답/보기 재생성
  * Blueprint 부적합 → Blueprint 교체
* 신뢰도 낮은 Fact 사용 시 인간 검토로 라우팅

---

## 🔚 결론

본 파이프라인은 문항 생성을 **언어 생성 문제가 아닌 사실 모델링 문제**로 재정의한다.
이를 통해 이미지 기반 문항의 **논리적 무결성, 재현성, 감사 가능성**을 구조적으로 보장한다.

---

### 📌 다음 단계 제안

* Fact Graph JSON Schema v1.0 명세
* Integrity Gate Rule Set (YAML)
* 이미지 유형별 Blueprint 카탈로그
* QTI 3.0 문항 실물 예제

원하시는 다음 산출물을 지정해 주시면 해당 문서를 동일한 형식으로 이어서 작성하겠습니다.
